#! /bin/sh

ID=$(doctl compute droplet create Flock --size 512mb --image ubuntu-16-04-x64 --region nyc3 --ssh-keys $1 | grep -E -o "^[0-9]+")
echo $ID
sleep 30 # Time to create droplet
IP=$(doctl compute droplet get $ID --format "PublicIPv4" | tail -1)
echo $IP > .test-ip
echo $IP
ssh root@$IP -i ~/.ssh/id_rsa sudo apt-get update && sudo apt-get -y install clang libicu-dev libpython2.7 libcurl4-openssl-dev
swift test
rm .test-ip
yes | doctl compute droplet delete Flock
echo
